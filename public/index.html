<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NarcoNations Local Research MCP</title>
    <link rel="stylesheet" href="app.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="hero">
        <div class="hero__copy">
          <h1>NarcoNations local research control room</h1>
          <p>
            Operate your offline corpus with cinematic clarity. Search, audit, and stream updates from the Model Context Protocol
            server, then hand the same endpoint directly to ChatGPT via the secure SSE bridge.
          </p>
        </div>
        <div class="hero__actions">
          <button class="primary" id="search-primary">Run a search</button>
          <a class="button secondary" href="https://modelcontextprotocol.io" target="_blank" rel="noreferrer">MCP Docs</a>
          <a class="button secondary" href="https://github.com/modelcontextprotocol/typescript-sdk" target="_blank" rel="noreferrer"
            >TypeScript SDK</a
          >
        </div>
      </header>

      <main>
        <section class="panel search-panel">
          <div class="section-header">
            <h2>Hybrid search</h2>
            <p class="status-message" id="search-status">Ready.</p>
          </div>
          <form class="search-form" id="search-form">
            <div class="search-row">
              <input type="text" id="search-query" name="query" placeholder="Search NarcoNations dossiers…" required />
              <button type="submit">Search local index</button>
            </div>
            <div class="search-row">
              <label>
                <span>Top K</span>
                <input type="number" id="search-k" name="k" min="1" max="32" value="8" />
              </label>
              <label class="alpha-control">
                <span>Hybrid weighting</span>
                <input type="range" id="search-alpha" name="alpha" min="0" max="1" step="0.05" value="0.65" />
                <span class="alpha-control__value">Dense/keyword mix: <span id="alpha-value">0.65</span></span>
              </label>
            </div>
            <div class="filters" id="filter-types">
              <label class="filter-chip">
                <input type="checkbox" value="pdf" checked />
                <span>PDF</span>
              </label>
              <label class="filter-chip">
                <input type="checkbox" value="markdown" checked />
                <span>Markdown</span>
              </label>
              <label class="filter-chip">
                <input type="checkbox" value="text" checked />
                <span>Text</span>
              </label>
              <label class="filter-chip">
                <input type="checkbox" value="word" checked />
                <span>Word</span>
              </label>
              <label class="filter-chip">
                <input type="checkbox" value="pages" checked />
                <span>Pages</span>
              </label>
            </div>
          </form>
          <div class="results" id="results"></div>
        </section>

        <section class="panel detail-panel">
          <h2>Document viewer &amp; stats</h2>
          <div class="doc-viewer" id="doc-viewer">
            <p class="status-message">Select a search result to stream the full source text.</p>
          </div>
          <div>
            <h3 class="status-message">Corpus metrics</h3>
            <div class="stats-grid" id="stats-grid"></div>
          </div>
        </section>

        <section class="panel control-panel">
          <div>
            <h2>Index controls</h2>
            <form id="reindex-form" class="form-block">
              <label for="reindex-paths">Paths (optional, newline or comma separated)</label>
              <textarea id="reindex-paths" placeholder="Leave blank to reindex configured roots"></textarea>
              <div class="form-actions">
                <button type="submit">Reindex now</button>
                <span class="status-message" id="reindex-status"></span>
              </div>
            </form>
          </div>

          <div>
            <h3>Watch for changes</h3>
            <form id="watch-form" class="form-block">
              <label for="watch-paths">Paths (optional)</label>
              <textarea id="watch-paths" placeholder="Leave blank for default roots"></textarea>
              <div class="form-actions">
                <button type="submit" class="secondary">Start watcher</button>
                <span class="status-message" id="watch-status"></span>
              </div>
            </form>
          </div>

          <div>
            <h3>Import ChatGPT export</h3>
            <form id="import-form" class="form-block">
              <label for="import-export">Export ZIP directory</label>
              <input type="text" id="import-export" placeholder="/path/to/chatgpt-export" />
              <label for="import-out">Output directory</label>
              <input type="text" id="import-out" placeholder="./docs/chatgpt-export-md" />
              <div class="form-actions">
                <button type="submit" class="secondary">Import &amp; reindex</button>
                <span class="status-message" id="import-status"></span>
              </div>
            </form>
          </div>

          <div>
            <h3>Activity stream</h3>
            <div class="log-stream" id="log-stream"></div>
          </div>
        </section>
      </main>

      <footer>
        Local MCP bridge · Optimised for Vercel deployments · Secure SSE endpoint for ChatGPT integration.
      </footer>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
